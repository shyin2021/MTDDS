                                                                                      QUERY PLAN                                                                                      
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=333041.35..333041.38 rows=12 width=152) (actual time=14315.174..14315.193 rows=564 loops=1)
   Sort Key: inv1.w_warehouse_sk, inv1.i_item_sk, inv1.mean, inv1.cov, inv2.mean, inv2.cov
   Sort Method: quicksort  Memory: 104kB
   CTE inv
     ->  Subquery Scan on foo  (cost=321284.02..326565.71 rows=140845 width=127) (actual time=6795.217..14278.209 rows=80832 loops=1)
           ->  Finalize HashAggregate  (cost=321284.02..324453.03 rows=140845 width=95) (actual time=6795.215..14246.300 rows=80832 loops=1)
                 Group Key: w_warehouse_sk, i_item_sk, d_moy
                 Filter: (CASE avg(inv_quantity_on_hand) WHEN '0'::numeric THEN '0'::numeric ELSE (stddev_samp(inv_quantity_on_hand) / avg(inv_quantity_on_hand)) END > '1'::numeric)
                 Rows Removed by Filter: 1215168
                 ->  Remote Subquery Scan on all (dn1,dn2,dn3)  (cost=305292.36..318349.77 rows=117370 width=95) (actual time=1756.503..2780.898 rows=3240000 loops=1)
   ->  Hash Join  (cost=3179.57..6475.42 rows=12 width=152) (actual time=14308.544..14314.986 rows=564 loops=1)
         Hash Cond: ((inv1.i_item_sk = inv2.i_item_sk) AND (inv1.w_warehouse_sk = inv2.w_warehouse_sk))
         ->  CTE Scan on inv inv1  (cost=0.00..3169.01 rows=704 width=76) (actual time=6795.306..6800.772 rows=7493 loops=1)
               Filter: (d_moy = 2)
               Rows Removed by Filter: 73339
         ->  Hash  (cost=3169.01..3169.01 rows=704 width=76) (actual time=7513.222..7513.222 rows=7549 loops=1)
               Buckets: 8192 (originally 1024)  Batches: 1 (originally 1)  Memory Usage: 539kB
               ->  CTE Scan on inv inv2  (cost=0.00..3169.01 rows=704 width=76) (actual time=0.072..7510.374 rows=7549 loops=1)
                     Filter: (d_moy = 3)
                     Rows Removed by Filter: 73283
 Planning time: 0.572 ms
 Execution time: 14375.670 ms
(22 rows)

 w_warehouse_sk | i_item_sk | d_moy |         mean         |        cov         | w_warehouse_sk | i_item_sk | d_moy |         mean         |        cov         
----------------+-----------+-------+----------------------+--------------------+----------------+-----------+-------+----------------------+--------------------
              1 |      4365 |     2 | 252.6666666666666667 | 1.5724824448612559 |              1 |      4365 |     3 | 250.0000000000000000 | 1.1718566465229440
              1 |      7123 |     2 | 129.0000000000000000 | 1.5306495508748217 |              1 |      7123 |     3 | 325.2500000000000000 | 1.3731091714305119
              1 |     13353 |     2 | 148.7500000000000000 | 1.6198042294026622 |              1 |     13353 |     3 | 342.0000000000000000 | 1.0503223533414211
              1 |     27138 |     2 | 293.2500000000000000 | 1.5961468454200682 |              1 |     27138 |     3 | 410.0000000000000000 | 1.0266081294426000
              2 |     21768 |     2 | 138.3333333333333333 | 1.5350570211114578 |              2 |     21768 |     3 | 381.6666666666666667 | 1.1366388623296585
              2 |     31371 |     2 | 251.2500000000000000 | 1.5229013106361313 |              2 |     31371 |     3 | 263.3333333333333333 | 1.1505848676104278
              2 |     35076 |     2 | 152.6666666666666667 | 1.5408660633694323 |              2 |     35076 |     3 | 507.5000000000000000 | 1.0937513758254975
              3 |      9054 |     2 | 183.5000000000000000 | 1.5601035500930027 |              3 |      9054 |     3 | 204.7500000000000000 | 1.1381259712106374
              3 |     11133 |     2 | 216.0000000000000000 | 1.6783583398559074 |              3 |     11133 |     3 | 182.7500000000000000 | 1.5664926246518577
              3 |     15678 |     2 | 267.2500000000000000 | 1.5733441276507091 |              3 |     15678 |     3 | 203.7500000000000000 | 1.5715046957995926
              3 |     20658 |     2 | 277.5000000000000000 | 1.5037595033765694 |              3 |     20658 |     3 | 313.3333333333333333 | 1.2394502753483553
              3 |     33102 |     2 | 285.7500000000000000 | 1.5533521705407384 |              3 |     33102 |     3 | 187.7500000000000000 | 1.0095738346400639
              4 |     13801 |     2 | 263.3333333333333333 | 1.6173485634150835 |              4 |     13801 |     3 | 321.5000000000000000 | 1.2053469107020156
              4 |     21597 |     2 | 356.0000000000000000 | 1.5047687526207416 |              4 |     21597 |     3 | 437.5000000000000000 | 1.0553261094462286
              5 |      5455 |     2 | 267.6666666666666667 | 1.5122055211915479 |              5 |      5455 |     3 | 327.0000000000000000 | 1.1052609976353333
              5 |     27714 |     2 | 222.0000000000000000 | 1.6381580938110631 |              5 |     27714 |     3 | 291.0000000000000000 | 1.2141044719285326
              6 |       552 |     2 | 130.0000000000000000 | 1.7795462932618308 |              6 |       552 |     3 | 414.0000000000000000 | 1.0642639263659855
              6 |      4953 |     2 | 242.5000000000000000 | 1.6154232369213691 |              6 |      4953 |     3 | 360.7500000000000000 | 1.1992521992367734
              6 |     11307 |     2 | 294.6666666666666667 | 1.5640796104236787 |              6 |     11307 |     3 | 259.0000000000000000 | 1.2895348293192741
              6 |     12549 |     2 | 223.0000000000000000 | 1.5637519952688610 |              6 |     12549 |     3 | 403.7500000000000000 | 1.0131178953978799
              6 |     33924 |     2 | 251.0000000000000000 | 1.5858608984010598 |              6 |     33924 |     3 | 343.7500000000000000 | 1.2168960016319709
(21 rows)

