== Parsed Logical Plan ==
CTE [wss]
:  +- 'SubqueryAlias wss
:     +- 'Aggregate ['d_week_seq, 'ss_store_sk], ['d_week_seq, 'ss_store_sk, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'ss_sales_price ELSE null END) AS sun_sales#36102, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'ss_sales_price ELSE null END) AS mon_sales#36103, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'ss_sales_price ELSE null END) AS tue_sales#36104, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'ss_sales_price ELSE null END) AS wed_sales#36105, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'ss_sales_price ELSE null END) AS thu_sales#36106, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'ss_sales_price ELSE null END) AS fri_sales#36107, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'ss_sales_price ELSE null END) AS sat_sales#36108]
:        +- 'Filter ('d_date_sk = 'ss_sold_date_sk)
:           +- 'Join Inner
:              :- 'UnresolvedRelation [store_sales], [], false
:              +- 'UnresolvedRelation [date_dim], [], false
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['s_store_name1 ASC NULLS FIRST, 's_store_id1 ASC NULLS FIRST, 'd_week_seq1 ASC NULLS FIRST], true
         +- 'Project ['s_store_name1, 's_store_id1, 'd_week_seq1, unresolvedalias(('sun_sales1 / 'sun_sales2), None), unresolvedalias(('mon_sales1 / 'mon_sales2), None), unresolvedalias(('tue_sales1 / 'tue_sales2), None), unresolvedalias(('wed_sales1 / 'wed_sales2), None), unresolvedalias(('thu_sales1 / 'thu_sales2), None), unresolvedalias(('fri_sales1 / 'fri_sales2), None), unresolvedalias(('sat_sales1 / 'sat_sales2), None)]
            +- 'Filter (('s_store_id1 = 's_store_id2) AND ('d_week_seq1 = ('d_week_seq2 - 52)))
               +- 'Join Inner
                  :- 'SubqueryAlias y
                  :  +- 'Project ['s_store_name AS s_store_name1#36082, 'wss.d_week_seq AS d_week_seq1#36083, 's_store_id AS s_store_id1#36084, 'sun_sales AS sun_sales1#36085, 'mon_sales AS mon_sales1#36086, 'tue_sales AS tue_sales1#36087, 'wed_sales AS wed_sales1#36088, 'thu_sales AS thu_sales1#36089, 'fri_sales AS fri_sales1#36090, 'sat_sales AS sat_sales1#36091]
                  :     +- 'Filter ((('d.d_week_seq = 'wss.d_week_seq) AND ('ss_store_sk = 's_store_sk)) AND (('d_month_seq >= 1205) AND ('d_month_seq <= (1205 + 11))))
                  :        +- 'Join Inner
                  :           :- 'Join Inner
                  :           :  :- 'UnresolvedRelation [wss], [], false
                  :           :  +- 'UnresolvedRelation [store], [], false
                  :           +- 'SubqueryAlias d
                  :              +- 'UnresolvedRelation [date_dim], [], false
                  +- 'SubqueryAlias x
                     +- 'Project ['s_store_name AS s_store_name2#36092, 'wss.d_week_seq AS d_week_seq2#36093, 's_store_id AS s_store_id2#36094, 'sun_sales AS sun_sales2#36095, 'mon_sales AS mon_sales2#36096, 'tue_sales AS tue_sales2#36097, 'wed_sales AS wed_sales2#36098, 'thu_sales AS thu_sales2#36099, 'fri_sales AS fri_sales2#36100, 'sat_sales AS sat_sales2#36101]
                        +- 'Filter ((('d.d_week_seq = 'wss.d_week_seq) AND ('ss_store_sk = 's_store_sk)) AND (('d_month_seq >= (1205 + 12)) AND ('d_month_seq <= (1205 + 23))))
                           +- 'Join Inner
                              :- 'Join Inner
                              :  :- 'UnresolvedRelation [wss], [], false
                              :  +- 'UnresolvedRelation [store], [], false
                              +- 'SubqueryAlias d
                                 +- 'UnresolvedRelation [date_dim], [], false

== Analyzed Logical Plan ==
s_store_name1: string, s_store_id1: string, d_week_seq1: int, (sun_sales1 / sun_sales2): double, (mon_sales1 / mon_sales2): double, (tue_sales1 / tue_sales2): double, (wed_sales1 / wed_sales2): double, (thu_sales1 / thu_sales2): double, (fri_sales1 / fri_sales2): double, (sat_sales1 / sat_sales2): double
WithCTE
:- CTERelationDef 53, false
:  +- SubqueryAlias wss
:     +- Aggregate [d_week_seq#28, ss_store_sk#1255], [d_week_seq#28, ss_store_sk#1255, sum(CASE WHEN (d_day_name#38 = Sunday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS sun_sales#36102, sum(CASE WHEN (d_day_name#38 = Monday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS mon_sales#36103, sum(CASE WHEN (d_day_name#38 = Tuesday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS tue_sales#36104, sum(CASE WHEN (d_day_name#38 = Wednesday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS wed_sales#36105, sum(CASE WHEN (d_day_name#38 = Thursday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS thu_sales#36106, sum(CASE WHEN (d_day_name#38 = Friday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS fri_sales#36107, sum(CASE WHEN (d_day_name#38 = Saturday) THEN ss_sales_price#1261 ELSE cast(null as double) END) AS sat_sales#36108]
:        +- Filter (d_date_sk#24 = ss_sold_date_sk#1248)
:           +- Join Inner
:              :- SubqueryAlias spark_catalog.m.store_sales
:              :  +- Relation spark_catalog.m.store_sales[ss_sold_date_sk#1248,ss_sold_time_sk#1249,ss_item_sk#1250,ss_customer_sk#1251,ss_cdemo_sk#1252,ss_hdemo_sk#1253,ss_addr_sk#1254,ss_store_sk#1255,ss_promo_sk#1256,ss_ticket_number#1257,ss_quantity#1258,ss_wholesale_cost#1259,ss_list_price#1260,ss_sales_price#1261,ss_ext_discount_amt#1262,ss_ext_sales_price#1263,ss_ext_wholesale_cost#1264,ss_ext_list_price#1265,ss_ext_tax#1266,ss_coupon_amt#1267,ss_net_paid#1268,ss_net_paid_inc_tax#1269,ss_net_profit#1270] parquet
:              +- SubqueryAlias spark_catalog.m.date_dim
:                 +- Relation spark_catalog.m.date_dim[d_date_sk#24,d_date_id#25,d_date#26,d_month_seq#27,d_week_seq#28,d_quarter_seq#29,d_year#30,d_dow#31,d_moy#32,d_dom#33,d_qoy#34,d_fy_year#35,d_fy_quarter_seq#36,d_fy_week_seq#37,d_day_name#38,d_quarter_name#39,d_holiday#40,d_weekend#41,d_following_holiday#42,d_first_dom#43,d_last_dom#44,d_same_day_ly#45,d_same_day_lq#46,d_current_day#47,... 4 more fields] parquet
+- GlobalLimit 100
   +- LocalLimit 100
      +- Sort [s_store_name1#36082 ASC NULLS FIRST, s_store_id1#36084 ASC NULLS FIRST, d_week_seq1#36083 ASC NULLS FIRST], true
         +- Project [s_store_name1#36082, s_store_id1#36084, d_week_seq1#36083, (sun_sales1#36085 / sun_sales2#36095) AS (sun_sales1 / sun_sales2)#36210, (mon_sales1#36086 / mon_sales2#36096) AS (mon_sales1 / mon_sales2)#36211, (tue_sales1#36087 / tue_sales2#36097) AS (tue_sales1 / tue_sales2)#36212, (wed_sales1#36088 / wed_sales2#36098) AS (wed_sales1 / wed_sales2)#36213, (thu_sales1#36089 / thu_sales2#36099) AS (thu_sales1 / thu_sales2)#36214, (fri_sales1#36090 / fri_sales2#36100) AS (fri_sales1 / fri_sales2)#36215, (sat_sales1#36091 / sat_sales2#36101) AS (sat_sales1 / sat_sales2)#36216]
            +- Filter ((s_store_id1#36084 = s_store_id2#36094) AND (d_week_seq1#36083 = (d_week_seq2#36093 - 52)))
               +- Join Inner
                  :- SubqueryAlias y
                  :  +- Project [s_store_name#57 AS s_store_name1#36082, d_week_seq#28 AS d_week_seq1#36083, s_store_id#53 AS s_store_id1#36084, sun_sales#36102 AS sun_sales1#36085, mon_sales#36103 AS mon_sales1#36086, tue_sales#36104 AS tue_sales1#36087, wed_sales#36105 AS wed_sales1#36088, thu_sales#36106 AS thu_sales1#36089, fri_sales#36107 AS fri_sales1#36090, sat_sales#36108 AS sat_sales1#36091]
                  :     +- Filter (((d_week_seq#36113 = d_week_seq#28) AND (ss_store_sk#1255 = s_store_sk#52)) AND ((d_month_seq#36112 >= 1205) AND (d_month_seq#36112 <= (1205 + 11))))
                  :        +- Join Inner
                  :           :- Join Inner
                  :           :  :- SubqueryAlias wss
                  :           :  :  +- CTERelationRef 53, true, [d_week_seq#28, ss_store_sk#1255, sun_sales#36102, mon_sales#36103, tue_sales#36104, wed_sales#36105, thu_sales#36106, fri_sales#36107, sat_sales#36108], false
                  :           :  +- SubqueryAlias spark_catalog.m.store
                  :           :     +- Relation spark_catalog.m.store[s_store_sk#52,s_store_id#53,s_rec_start_date#54,s_rec_end_date#55,s_closed_date_sk#56,s_store_name#57,s_number_employees#58,s_floor_space#59,s_hours#60,s_manager#61,s_market_id#62,s_geography_class#63,s_market_desc#64,s_market_manager#65,s_division_id#66,s_division_name#67,s_company_id#68,s_company_name#69,s_street_number#70,s_street_name#71,s_street_type#72,s_suite_number#73,s_city#74,s_county#75,... 5 more fields] parquet
                  :           +- SubqueryAlias d
                  :              +- SubqueryAlias spark_catalog.m.date_dim
                  :                 +- Relation spark_catalog.m.date_dim[d_date_sk#36109,d_date_id#36110,d_date#36111,d_month_seq#36112,d_week_seq#36113,d_quarter_seq#36114,d_year#36115,d_dow#36116,d_moy#36117,d_dom#36118,d_qoy#36119,d_fy_year#36120,d_fy_quarter_seq#36121,d_fy_week_seq#36122,d_day_name#36123,d_quarter_name#36124,d_holiday#36125,d_weekend#36126,d_following_holiday#36127,d_first_dom#36128,d_last_dom#36129,d_same_day_ly#36130,d_same_day_lq#36131,d_current_day#36132,... 4 more fields] parquet
                  +- SubqueryAlias x
                     +- Project [s_store_name#36142 AS s_store_name2#36092, d_week_seq#36201 AS d_week_seq2#36093, s_store_id#36138 AS s_store_id2#36094, sun_sales#36203 AS sun_sales2#36095, mon_sales#36204 AS mon_sales2#36096, tue_sales#36205 AS tue_sales2#36097, wed_sales#36206 AS wed_sales2#36098, thu_sales#36207 AS thu_sales2#36099, fri_sales#36208 AS fri_sales2#36100, sat_sales#36209 AS sat_sales2#36101]
                        +- Filter (((d_week_seq#36170 = d_week_seq#36201) AND (ss_store_sk#36202 = s_store_sk#36137)) AND ((d_month_seq#36169 >= (1205 + 12)) AND (d_month_seq#36169 <= (1205 + 23))))
                           +- Join Inner
                              :- Join Inner
                              :  :- SubqueryAlias wss
                              :  :  +- CTERelationRef 53, true, [d_week_seq#36201, ss_store_sk#36202, sun_sales#36203, mon_sales#36204, tue_sales#36205, wed_sales#36206, thu_sales#36207, fri_sales#36208, sat_sales#36209], false
                              :  +- SubqueryAlias spark_catalog.m.store
                              :     +- Relation spark_catalog.m.store[s_store_sk#36137,s_store_id#36138,s_rec_start_date#36139,s_rec_end_date#36140,s_closed_date_sk#36141,s_store_name#36142,s_number_employees#36143,s_floor_space#36144,s_hours#36145,s_manager#36146,s_market_id#36147,s_geography_class#36148,s_market_desc#36149,s_market_manager#36150,s_division_id#36151,s_division_name#36152,s_company_id#36153,s_company_name#36154,s_street_number#36155,s_street_name#36156,s_street_type#36157,s_suite_number#36158,s_city#36159,s_county#36160,... 5 more fields] parquet
                              +- SubqueryAlias d
                                 +- SubqueryAlias spark_catalog.m.date_dim
                                    +- Relation spark_catalog.m.date_dim[d_date_sk#36166,d_date_id#36167,d_date#36168,d_month_seq#36169,d_week_seq#36170,d_quarter_seq#36171,d_year#36172,d_dow#36173,d_moy#36174,d_dom#36175,d_qoy#36176,d_fy_year#36177,d_fy_quarter_seq#36178,d_fy_week_seq#36179,d_day_name#36180,d_quarter_name#36181,d_holiday#36182,d_weekend#36183,d_following_holiday#36184,d_first_dom#36185,d_last_dom#36186,d_same_day_ly#36187,d_same_day_lq#36188,d_current_day#36189,... 4 more fields] parquet

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [s_store_name1#36082 ASC NULLS FIRST, s_store_id1#36084 ASC NULLS FIRST, d_week_seq1#36083 ASC NULLS FIRST], true
      +- Project [s_store_name1#36082, s_store_id1#36084, d_week_seq1#36083, (sun_sales1#36085 / sun_sales2#36095) AS (sun_sales1 / sun_sales2)#36210, (mon_sales1#36086 / mon_sales2#36096) AS (mon_sales1 / mon_sales2)#36211, (tue_sales1#36087 / tue_sales2#36097) AS (tue_sales1 / tue_sales2)#36212, (wed_sales1#36088 / wed_sales2#36098) AS (wed_sales1 / wed_sales2)#36213, (thu_sales1#36089 / thu_sales2#36099) AS (thu_sales1 / thu_sales2)#36214, (fri_sales1#36090 / fri_sales2#36100) AS (fri_sales1 / fri_sales2)#36215, (sat_sales1#36091 / sat_sales2#36101) AS (sat_sales1 / sat_sales2)#36216]
         +- Join Inner, ((s_store_id1#36084 = s_store_id2#36094) AND (d_week_seq1#36083 = (d_week_seq2#36093 - 52)))
            :- Project [s_store_name#57 AS s_store_name1#36082, d_week_seq#28 AS d_week_seq1#36083, s_store_id#53 AS s_store_id1#36084, sun_sales#36102 AS sun_sales1#36085, mon_sales#36103 AS mon_sales1#36086, tue_sales#36104 AS tue_sales1#36087, wed_sales#36105 AS wed_sales1#36088, thu_sales#36106 AS thu_sales1#36089, fri_sales#36107 AS fri_sales1#36090, sat_sales#36108 AS sat_sales1#36091]
            :  +- Join Inner, (d_week_seq#36113 = d_week_seq#28)
            :     :- Project [d_week_seq#28, sun_sales#36102, mon_sales#36103, tue_sales#36104, wed_sales#36105, thu_sales#36106, fri_sales#36107, sat_sales#36108, s_store_id#53, s_store_name#57]
            :     :  +- Join Inner, (ss_store_sk#1255 = s_store_sk#52)
            :     :     :- Aggregate [d_week_seq#28, ss_store_sk#1255], [d_week_seq#28, ss_store_sk#1255, sum(CASE WHEN (d_day_name#38 = Sunday) THEN ss_sales_price#1261 END) AS sun_sales#36102, sum(CASE WHEN (d_day_name#38 = Monday) THEN ss_sales_price#1261 END) AS mon_sales#36103, sum(CASE WHEN (d_day_name#38 = Tuesday) THEN ss_sales_price#1261 END) AS tue_sales#36104, sum(CASE WHEN (d_day_name#38 = Wednesday) THEN ss_sales_price#1261 END) AS wed_sales#36105, sum(CASE WHEN (d_day_name#38 = Thursday) THEN ss_sales_price#1261 END) AS thu_sales#36106, sum(CASE WHEN (d_day_name#38 = Friday) THEN ss_sales_price#1261 END) AS fri_sales#36107, sum(CASE WHEN (d_day_name#38 = Saturday) THEN ss_sales_price#1261 END) AS sat_sales#36108]
            :     :     :  +- Project [ss_store_sk#1255, ss_sales_price#1261, d_week_seq#28, d_day_name#38]
            :     :     :     +- Join Inner, (d_date_sk#24 = ss_sold_date_sk#1248)
            :     :     :        :- Project [ss_sold_date_sk#1248, ss_store_sk#1255, ss_sales_price#1261]
            :     :     :        :  +- Filter (isnotnull(ss_sold_date_sk#1248) AND isnotnull(ss_store_sk#1255))
            :     :     :        :     +- Relation spark_catalog.m.store_sales[ss_sold_date_sk#1248,ss_sold_time_sk#1249,ss_item_sk#1250,ss_customer_sk#1251,ss_cdemo_sk#1252,ss_hdemo_sk#1253,ss_addr_sk#1254,ss_store_sk#1255,ss_promo_sk#1256,ss_ticket_number#1257,ss_quantity#1258,ss_wholesale_cost#1259,ss_list_price#1260,ss_sales_price#1261,ss_ext_discount_amt#1262,ss_ext_sales_price#1263,ss_ext_wholesale_cost#1264,ss_ext_list_price#1265,ss_ext_tax#1266,ss_coupon_amt#1267,ss_net_paid#1268,ss_net_paid_inc_tax#1269,ss_net_profit#1270] parquet
            :     :     :        +- Project [d_date_sk#24, d_week_seq#28, d_day_name#38]
            :     :     :           +- Filter (isnotnull(d_date_sk#24) AND isnotnull(d_week_seq#28))
            :     :     :              +- Relation spark_catalog.m.date_dim[d_date_sk#24,d_date_id#25,d_date#26,d_month_seq#27,d_week_seq#28,d_quarter_seq#29,d_year#30,d_dow#31,d_moy#32,d_dom#33,d_qoy#34,d_fy_year#35,d_fy_quarter_seq#36,d_fy_week_seq#37,d_day_name#38,d_quarter_name#39,d_holiday#40,d_weekend#41,d_following_holiday#42,d_first_dom#43,d_last_dom#44,d_same_day_ly#45,d_same_day_lq#46,d_current_day#47,... 4 more fields] parquet
            :     :     +- Project [s_store_sk#52, s_store_id#53, s_store_name#57]
            :     :        +- Filter (isnotnull(s_store_sk#52) AND isnotnull(s_store_id#53))
            :     :           +- Relation spark_catalog.m.store[s_store_sk#52,s_store_id#53,s_rec_start_date#54,s_rec_end_date#55,s_closed_date_sk#56,s_store_name#57,s_number_employees#58,s_floor_space#59,s_hours#60,s_manager#61,s_market_id#62,s_geography_class#63,s_market_desc#64,s_market_manager#65,s_division_id#66,s_division_name#67,s_company_id#68,s_company_name#69,s_street_number#70,s_street_name#71,s_street_type#72,s_suite_number#73,s_city#74,s_county#75,... 5 more fields] parquet
            :     +- Project [d_week_seq#36113]
            :        +- Filter ((isnotnull(d_month_seq#36112) AND ((d_month_seq#36112 >= 1205) AND (d_month_seq#36112 <= 1216))) AND isnotnull(d_week_seq#36113))
            :           +- Relation spark_catalog.m.date_dim[d_date_sk#36109,d_date_id#36110,d_date#36111,d_month_seq#36112,d_week_seq#36113,d_quarter_seq#36114,d_year#36115,d_dow#36116,d_moy#36117,d_dom#36118,d_qoy#36119,d_fy_year#36120,d_fy_quarter_seq#36121,d_fy_week_seq#36122,d_day_name#36123,d_quarter_name#36124,d_holiday#36125,d_weekend#36126,d_following_holiday#36127,d_first_dom#36128,d_last_dom#36129,d_same_day_ly#36130,d_same_day_lq#36131,d_current_day#36132,... 4 more fields] parquet
            +- Project [d_week_seq#36628 AS d_week_seq2#36093, s_store_id#36138 AS s_store_id2#36094, sun_sales#36203 AS sun_sales2#36095, mon_sales#36204 AS mon_sales2#36096, tue_sales#36205 AS tue_sales2#36097, wed_sales#36206 AS wed_sales2#36098, thu_sales#36207 AS thu_sales2#36099, fri_sales#36208 AS fri_sales2#36100, sat_sales#36209 AS sat_sales2#36101]
               +- Join Inner, (d_week_seq#36170 = d_week_seq#36628)
                  :- Project [d_week_seq#36628, sun_sales#36203, mon_sales#36204, tue_sales#36205, wed_sales#36206, thu_sales#36207, fri_sales#36208, sat_sales#36209, s_store_id#36138]
                  :  +- Join Inner, (ss_store_sk#36608 = s_store_sk#36137)
                  :     :- Aggregate [d_week_seq#36628, ss_store_sk#36608], [d_week_seq#36628, ss_store_sk#36608, sum(CASE WHEN (d_day_name#36638 = Sunday) THEN ss_sales_price#36614 END) AS sun_sales#36203, sum(CASE WHEN (d_day_name#36638 = Monday) THEN ss_sales_price#36614 END) AS mon_sales#36204, sum(CASE WHEN (d_day_name#36638 = Tuesday) THEN ss_sales_price#36614 END) AS tue_sales#36205, sum(CASE WHEN (d_day_name#36638 = Wednesday) THEN ss_sales_price#36614 END) AS wed_sales#36206, sum(CASE WHEN (d_day_name#36638 = Thursday) THEN ss_sales_price#36614 END) AS thu_sales#36207, sum(CASE WHEN (d_day_name#36638 = Friday) THEN ss_sales_price#36614 END) AS fri_sales#36208, sum(CASE WHEN (d_day_name#36638 = Saturday) THEN ss_sales_price#36614 END) AS sat_sales#36209]
                  :     :  +- Project [ss_store_sk#36608, ss_sales_price#36614, d_week_seq#36628, d_day_name#36638]
                  :     :     +- Join Inner, (d_date_sk#36624 = ss_sold_date_sk#36601)
                  :     :        :- Project [ss_sold_date_sk#36601, ss_store_sk#36608, ss_sales_price#36614]
                  :     :        :  +- Filter (isnotnull(ss_sold_date_sk#36601) AND isnotnull(ss_store_sk#36608))
                  :     :        :     +- Relation spark_catalog.m.store_sales[ss_sold_date_sk#36601,ss_sold_time_sk#36602,ss_item_sk#36603,ss_customer_sk#36604,ss_cdemo_sk#36605,ss_hdemo_sk#36606,ss_addr_sk#36607,ss_store_sk#36608,ss_promo_sk#36609,ss_ticket_number#36610,ss_quantity#36611,ss_wholesale_cost#36612,ss_list_price#36613,ss_sales_price#36614,ss_ext_discount_amt#36615,ss_ext_sales_price#36616,ss_ext_wholesale_cost#36617,ss_ext_list_price#36618,ss_ext_tax#36619,ss_coupon_amt#36620,ss_net_paid#36621,ss_net_paid_inc_tax#36622,ss_net_profit#36623] parquet
                  :     :        +- Project [d_date_sk#36624, d_week_seq#36628, d_day_name#36638]
                  :     :           +- Filter (isnotnull(d_date_sk#36624) AND isnotnull(d_week_seq#36628))
                  :     :              +- Relation spark_catalog.m.date_dim[d_date_sk#36624,d_date_id#36625,d_date#36626,d_month_seq#36627,d_week_seq#36628,d_quarter_seq#36629,d_year#36630,d_dow#36631,d_moy#36632,d_dom#36633,d_qoy#36634,d_fy_year#36635,d_fy_quarter_seq#36636,d_fy_week_seq#36637,d_day_name#36638,d_quarter_name#36639,d_holiday#36640,d_weekend#36641,d_following_holiday#36642,d_first_dom#36643,d_last_dom#36644,d_same_day_ly#36645,d_same_day_lq#36646,d_current_day#36647,... 4 more fields] parquet
                  :     +- Project [s_store_sk#36137, s_store_id#36138]
                  :        +- Filter (isnotnull(s_store_sk#36137) AND isnotnull(s_store_id#36138))
                  :           +- Relation spark_catalog.m.store[s_store_sk#36137,s_store_id#36138,s_rec_start_date#36139,s_rec_end_date#36140,s_closed_date_sk#36141,s_store_name#36142,s_number_employees#36143,s_floor_space#36144,s_hours#36145,s_manager#36146,s_market_id#36147,s_geography_class#36148,s_market_desc#36149,s_market_manager#36150,s_division_id#36151,s_division_name#36152,s_company_id#36153,s_company_name#36154,s_street_number#36155,s_street_name#36156,s_street_type#36157,s_suite_number#36158,s_city#36159,s_county#36160,... 5 more fields] parquet
                  +- Project [d_week_seq#36170]
                     +- Filter ((isnotnull(d_month_seq#36169) AND ((d_month_seq#36169 >= 1217) AND (d_month_seq#36169 <= 1228))) AND isnotnull(d_week_seq#36170))
                        +- Relation spark_catalog.m.date_dim[d_date_sk#36166,d_date_id#36167,d_date#36168,d_month_seq#36169,d_week_seq#36170,d_quarter_seq#36171,d_year#36172,d_dow#36173,d_moy#36174,d_dom#36175,d_qoy#36176,d_fy_year#36177,d_fy_quarter_seq#36178,d_fy_week_seq#36179,d_day_name#36180,d_quarter_name#36181,d_holiday#36182,d_weekend#36183,d_following_holiday#36184,d_first_dom#36185,d_last_dom#36186,d_same_day_ly#36187,d_same_day_lq#36188,d_current_day#36189,... 4 more fields] parquet

== Physical Plan ==
AdaptiveSparkPlan isFinalPlan=false
+- TakeOrderedAndProject(limit=100, orderBy=[s_store_name1#36082 ASC NULLS FIRST,s_store_id1#36084 ASC NULLS FIRST,d_week_seq1#36083 ASC NULLS FIRST], output=[s_store_name1#36082,s_store_id1#36084,d_week_seq1#36083,(sun_sales1 / sun_sales2)#36210,(mon_sales1 / mon_sales2)#36211,(tue_sales1 / tue_sales2)#36212,(wed_sales1 / wed_sales2)#36213,(thu_sales1 / thu_sales2)#36214,(fri_sales1 / fri_sales2)#36215,(sat_sales1 / sat_sales2)#36216])
   +- Project [s_store_name1#36082, s_store_id1#36084, d_week_seq1#36083, (sun_sales1#36085 / sun_sales2#36095) AS (sun_sales1 / sun_sales2)#36210, (mon_sales1#36086 / mon_sales2#36096) AS (mon_sales1 / mon_sales2)#36211, (tue_sales1#36087 / tue_sales2#36097) AS (tue_sales1 / tue_sales2)#36212, (wed_sales1#36088 / wed_sales2#36098) AS (wed_sales1 / wed_sales2)#36213, (thu_sales1#36089 / thu_sales2#36099) AS (thu_sales1 / thu_sales2)#36214, (fri_sales1#36090 / fri_sales2#36100) AS (fri_sales1 / fri_sales2)#36215, (sat_sales1#36091 / sat_sales2#36101) AS (sat_sales1 / sat_sales2)#36216]
      +- SortMergeJoin [s_store_id1#36084, d_week_seq1#36083], [s_store_id2#36094, (d_week_seq2#36093 - 52)], Inner
         :- Sort [s_store_id1#36084 ASC NULLS FIRST, d_week_seq1#36083 ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(s_store_id1#36084, d_week_seq1#36083, 200), ENSURE_REQUIREMENTS, [plan_id=114405]
         :     +- Project [s_store_name#57 AS s_store_name1#36082, d_week_seq#28 AS d_week_seq1#36083, s_store_id#53 AS s_store_id1#36084, sun_sales#36102 AS sun_sales1#36085, mon_sales#36103 AS mon_sales1#36086, tue_sales#36104 AS tue_sales1#36087, wed_sales#36105 AS wed_sales1#36088, thu_sales#36106 AS thu_sales1#36089, fri_sales#36107 AS fri_sales1#36090, sat_sales#36108 AS sat_sales1#36091]
         :        +- BroadcastHashJoin [d_week_seq#28], [d_week_seq#36113], Inner, BuildRight, false
         :           :- Project [d_week_seq#28, sun_sales#36102, mon_sales#36103, tue_sales#36104, wed_sales#36105, thu_sales#36106, fri_sales#36107, sat_sales#36108, s_store_id#53, s_store_name#57]
         :           :  +- BroadcastHashJoin [ss_store_sk#1255], [s_store_sk#52], Inner, BuildRight, false
         :           :     :- HashAggregate(keys=[d_week_seq#28, ss_store_sk#1255], functions=[sum(CASE WHEN (d_day_name#38 = Sunday) THEN ss_sales_price#1261 END), sum(CASE WHEN (d_day_name#38 = Monday) THEN ss_sales_price#1261 END), sum(CASE WHEN (d_day_name#38 = Tuesday) THEN ss_sales_price#1261 END), sum(CASE WHEN (d_day_name#38 = Wednesday) THEN ss_sales_price#1261 END), sum(CASE WHEN (d_day_name#38 = Thursday) THEN ss_sales_price#1261 END), sum(CASE WHEN (d_day_name#38 = Friday) THEN ss_sales_price#1261 END), sum(CASE WHEN (d_day_name#38 = Saturday) THEN ss_sales_price#1261 END)], output=[d_week_seq#28, ss_store_sk#1255, sun_sales#36102, mon_sales#36103, tue_sales#36104, wed_sales#36105, thu_sales#36106, fri_sales#36107, sat_sales#36108])
         :           :     :  +- Exchange hashpartitioning(d_week_seq#28, ss_store_sk#1255, 200), ENSURE_REQUIREMENTS, [plan_id=114378]
         :           :     :     +- HashAggregate(keys=[d_week_seq#28, ss_store_sk#1255], functions=[partial_sum(CASE WHEN (d_day_name#38 = Sunday) THEN ss_sales_price#1261 END), partial_sum(CASE WHEN (d_day_name#38 = Monday) THEN ss_sales_price#1261 END), partial_sum(CASE WHEN (d_day_name#38 = Tuesday) THEN ss_sales_price#1261 END), partial_sum(CASE WHEN (d_day_name#38 = Wednesday) THEN ss_sales_price#1261 END), partial_sum(CASE WHEN (d_day_name#38 = Thursday) THEN ss_sales_price#1261 END), partial_sum(CASE WHEN (d_day_name#38 = Friday) THEN ss_sales_price#1261 END), partial_sum(CASE WHEN (d_day_name#38 = Saturday) THEN ss_sales_price#1261 END)], output=[d_week_seq#28, ss_store_sk#1255, sum#36666, sum#36667, sum#36668, sum#36669, sum#36670, sum#36671, sum#36672])
         :           :     :        +- Project [ss_store_sk#1255, ss_sales_price#1261, d_week_seq#28, d_day_name#38]
         :           :     :           +- BroadcastHashJoin [ss_sold_date_sk#1248], [d_date_sk#24], Inner, BuildRight, false
         :           :     :              :- Filter (isnotnull(ss_sold_date_sk#1248) AND isnotnull(ss_store_sk#1255))
         :           :     :              :  +- FileScan parquet spark_catalog.m.store_sales[ss_sold_date_sk#1248,ss_store_sk#1255,ss_sales_price#1261] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#1248), isnotnull(ss_store_sk#1255)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/store_sales], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_store_sk:int,ss_sales_price:double>
         :           :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=114373]
         :           :     :                 +- Filter (isnotnull(d_date_sk#24) AND isnotnull(d_week_seq#28))
         :           :     :                    +- FileScan parquet spark_catalog.m.date_dim[d_date_sk#24,d_week_seq#28,d_day_name#38] Batched: true, DataFilters: [isnotnull(d_date_sk#24), isnotnull(d_week_seq#28)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_week_seq:int,d_day_name:string>
         :           :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=114381]
         :           :        +- Filter (isnotnull(s_store_sk#52) AND isnotnull(s_store_id#53))
         :           :           +- FileScan parquet spark_catalog.m.store[s_store_sk#52,s_store_id#53,s_store_name#57] Batched: true, DataFilters: [isnotnull(s_store_sk#52), isnotnull(s_store_id#53)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_id)], ReadSchema: struct<s_store_sk:int,s_store_id:string,s_store_name:string>
         :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [plan_id=114385]
         :              +- Project [d_week_seq#36113]
         :                 +- Filter (((isnotnull(d_month_seq#36112) AND (d_month_seq#36112 >= 1205)) AND (d_month_seq#36112 <= 1216)) AND isnotnull(d_week_seq#36113))
         :                    +- FileScan parquet spark_catalog.m.date_dim[d_month_seq#36112,d_week_seq#36113] Batched: true, DataFilters: [isnotnull(d_month_seq#36112), (d_month_seq#36112 >= 1205), (d_month_seq#36112 <= 1216), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1205), LessThanOrEqual(d_month_seq,1216),..., ReadSchema: struct<d_month_seq:int,d_week_seq:int>
         +- Sort [s_store_id2#36094 ASC NULLS FIRST, (d_week_seq2#36093 - 52) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(s_store_id2#36094, (d_week_seq2#36093 - 52), 200), ENSURE_REQUIREMENTS, [plan_id=114406]
               +- Project [d_week_seq#36628 AS d_week_seq2#36093, s_store_id#36138 AS s_store_id2#36094, sun_sales#36203 AS sun_sales2#36095, mon_sales#36204 AS mon_sales2#36096, tue_sales#36205 AS tue_sales2#36097, wed_sales#36206 AS wed_sales2#36098, thu_sales#36207 AS thu_sales2#36099, fri_sales#36208 AS fri_sales2#36100, sat_sales#36209 AS sat_sales2#36101]
                  +- BroadcastHashJoin [d_week_seq#36628], [d_week_seq#36170], Inner, BuildRight, false
                     :- Project [d_week_seq#36628, sun_sales#36203, mon_sales#36204, tue_sales#36205, wed_sales#36206, thu_sales#36207, fri_sales#36208, sat_sales#36209, s_store_id#36138]
                     :  +- BroadcastHashJoin [ss_store_sk#36608], [s_store_sk#36137], Inner, BuildRight, false
                     :     :- HashAggregate(keys=[d_week_seq#36628, ss_store_sk#36608], functions=[sum(CASE WHEN (d_day_name#36638 = Sunday) THEN ss_sales_price#36614 END), sum(CASE WHEN (d_day_name#36638 = Monday) THEN ss_sales_price#36614 END), sum(CASE WHEN (d_day_name#36638 = Tuesday) THEN ss_sales_price#36614 END), sum(CASE WHEN (d_day_name#36638 = Wednesday) THEN ss_sales_price#36614 END), sum(CASE WHEN (d_day_name#36638 = Thursday) THEN ss_sales_price#36614 END), sum(CASE WHEN (d_day_name#36638 = Friday) THEN ss_sales_price#36614 END), sum(CASE WHEN (d_day_name#36638 = Saturday) THEN ss_sales_price#36614 END)], output=[d_week_seq#36628, ss_store_sk#36608, sun_sales#36203, mon_sales#36204, tue_sales#36205, wed_sales#36206, thu_sales#36207, fri_sales#36208, sat_sales#36209])
                     :     :  +- Exchange hashpartitioning(d_week_seq#36628, ss_store_sk#36608, 200), ENSURE_REQUIREMENTS, [plan_id=114393]
                     :     :     +- HashAggregate(keys=[d_week_seq#36628, ss_store_sk#36608], functions=[partial_sum(CASE WHEN (d_day_name#36638 = Sunday) THEN ss_sales_price#36614 END), partial_sum(CASE WHEN (d_day_name#36638 = Monday) THEN ss_sales_price#36614 END), partial_sum(CASE WHEN (d_day_name#36638 = Tuesday) THEN ss_sales_price#36614 END), partial_sum(CASE WHEN (d_day_name#36638 = Wednesday) THEN ss_sales_price#36614 END), partial_sum(CASE WHEN (d_day_name#36638 = Thursday) THEN ss_sales_price#36614 END), partial_sum(CASE WHEN (d_day_name#36638 = Friday) THEN ss_sales_price#36614 END), partial_sum(CASE WHEN (d_day_name#36638 = Saturday) THEN ss_sales_price#36614 END)], output=[d_week_seq#36628, ss_store_sk#36608, sum#36680, sum#36681, sum#36682, sum#36683, sum#36684, sum#36685, sum#36686])
                     :     :        +- Project [ss_store_sk#36608, ss_sales_price#36614, d_week_seq#36628, d_day_name#36638]
                     :     :           +- BroadcastHashJoin [ss_sold_date_sk#36601], [d_date_sk#36624], Inner, BuildRight, false
                     :     :              :- Filter (isnotnull(ss_sold_date_sk#36601) AND isnotnull(ss_store_sk#36608))
                     :     :              :  +- FileScan parquet spark_catalog.m.store_sales[ss_sold_date_sk#36601,ss_store_sk#36608,ss_sales_price#36614] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#36601), isnotnull(ss_store_sk#36608)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/store_sales], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_store_sk:int,ss_sales_price:double>
                     :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=114388]
                     :     :                 +- Filter (isnotnull(d_date_sk#36624) AND isnotnull(d_week_seq#36628))
                     :     :                    +- FileScan parquet spark_catalog.m.date_dim[d_date_sk#36624,d_week_seq#36628,d_day_name#36638] Batched: true, DataFilters: [isnotnull(d_date_sk#36624), isnotnull(d_week_seq#36628)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_week_seq:int,d_day_name:string>
                     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [plan_id=114396]
                     :        +- Filter (isnotnull(s_store_sk#36137) AND isnotnull(s_store_id#36138))
                     :           +- FileScan parquet spark_catalog.m.store[s_store_sk#36137,s_store_id#36138] Batched: true, DataFilters: [isnotnull(s_store_sk#36137), isnotnull(s_store_id#36138)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/store], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_id)], ReadSchema: struct<s_store_sk:int,s_store_id:string>
                     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [plan_id=114400]
                        +- Project [d_week_seq#36170]
                           +- Filter (((isnotnull(d_month_seq#36169) AND (d_month_seq#36169 >= 1217)) AND (d_month_seq#36169 <= 1228)) AND isnotnull(d_week_seq#36170))
                              +- FileScan parquet spark_catalog.m.date_dim[d_month_seq#36169,d_week_seq#36170] Batched: true, DataFilters: [isnotnull(d_month_seq#36169), (d_month_seq#36169 >= 1217), (d_month_seq#36169 <= 1228), isnotnul..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[hdfs://gros-121:9000/usr/spark/spark-warehouse/m.db/date_dim], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1217), LessThanOrEqual(d_month_seq,1228),..., ReadSchema: struct<d_month_seq:int,d_week_seq:int>
